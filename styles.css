:root {
  --bg-1: #0c0a11;
  --bg-2: #1a0f20;
  --amber: #f8c99a;
  --gold: #ffd9ad;
  --paper: #f6e8d2;
  --paper-2: #ecd5b8;
  --ink: #312017;
  --wine: #8f2037;
  --ivory: #f7eee2;
}

* { box-sizing: border-box; }

html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  font-family: 'Cormorant Garamond', serif;
  color: var(--ivory);
  background: radial-gradient(circle at 78% 14%, #4d2b27 0%, #251321 30%, #0c0a11 100%);
}

#fxCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  opacity: 0;
  transition: opacity 2s ease;
}

.scene {
  position: relative;
  z-index: 1;
  height: 100vh;
  display: grid;
  place-items: center;
  perspective: 1300px;
  isolation: isolate;
}

.sky-glow {
  pointer-events: none;
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 72% 15%, rgba(255, 193, 128, 0.42), transparent 34%),
    radial-gradient(circle at 15% 20%, rgba(138, 128, 255, 0.18), transparent 40%),
    linear-gradient(165deg, rgba(22, 10, 17, 0.3), rgba(8, 8, 16, 0.8));
  transition: background 1.6s ease;
}

.light-ray {
  position: absolute;
  width: 45vw;
  height: 120vh;
  top: -8vh;
  background: linear-gradient(to bottom, rgba(255, 222, 176, 0.22), rgba(255, 222, 176, 0));
  filter: blur(9px);
  transform: rotate(18deg);
  animation: drift 12s ease-in-out infinite alternate;
  pointer-events: none;
}

.ray-1 { left: 58vw; }
.ray-2 { left: 45vw; opacity: 0.45; animation-duration: 16s; }

.desk {
  pointer-events: none;
  position: absolute;
  inset: 45% -10% -15% -10%;
  background:
    repeating-linear-gradient(12deg, rgba(93, 52, 30, 0.92), rgba(93, 52, 30, 0.92) 15px, rgba(119, 70, 43, 0.92) 15px, rgba(119, 70, 43, 0.92) 30px);
  transform: rotateX(72deg);
  transform-origin: center top;
  box-shadow: inset 0 80px 180px rgba(0, 0, 0, 0.55);
}

.stage,
.letter-stage {
  position: absolute;
  z-index: 3;
  width: min(92vw, 900px);
  display: grid;
  place-items: center;
  gap: 1rem;
}

.envelope-wrap {
  width: min(82vw, 620px);
  aspect-ratio: 8 / 5;
  position: relative;
  transform-style: preserve-3d;
  animation: floatEnvelope 4.8s ease-in-out infinite;
}

.envelope {
  position: absolute;
  inset: 0;
  border-radius: 16px;
}

.envelope.shadow {
  transform: translateY(24px) scale(0.95);
  filter: blur(12px);
  background: rgba(0, 0, 0, 0.42);
}

.envelope.card {
  transform-style: preserve-3d;
  transition: transform 220ms ease;
}

.body,
.bottom-fold,
.top-flap {
  position: absolute;
  inset: 0;
  border-radius: 16px;
  box-shadow: 0 28px 70px rgba(0, 0, 0, 0.45);
}

.body {
  background: linear-gradient(160deg, #faebd7 0%, #f2dcc0 58%, #e7cbab 100%);
  overflow: hidden;
  z-index: 2;
}

.bottom-fold {
  background: linear-gradient(315deg, #ddc1a2 0%, #efd8bb 100%);
  clip-path: polygon(0 100%, 50% 34%, 100% 100%);
  z-index: 3;
}

.top-flap {
  background: linear-gradient(10deg, #f0dfc7 0%, #faecdb 100%);
  clip-path: polygon(0 0, 50% 63%, 100% 0);
  z-index: 4;
  transform-origin: top center;
  transition: transform 1.15s cubic-bezier(0.2, 1, 0.28, 1);
}

.envelope-open .top-flap { transform: rotateX(178deg); }

.recipient {
  margin: 0;
  position: absolute;
  top: 29%;
  width: 100%;
  text-align: center;
  font-family: 'Great Vibes', cursive;
  color: #4f3327;
  font-size: clamp(2.2rem, 5.7vw, 3.3rem);
}

.seal {
  position: absolute;
  left: 50%;
  top: 60%;
  transform: translate(-50%, -50%);
  width: clamp(70px, 10vw, 86px);
  aspect-ratio: 1;
  border: 0;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 20%, #c35668 0%, var(--wine) 70%);
  box-shadow: inset 0 0 14px rgba(255, 190, 196, 0.25), 0 8px 20px rgba(0, 0, 0, 0.35);
  cursor: grab;
  z-index: 5;
}

.seal.dragging { cursor: grabbing; filter: saturate(1.15); }
.seal.cracked { background: repeating-conic-gradient(from 0deg, #721625 0deg 12deg, #ac3a4b 12deg 24deg); }

.seal-progress {
  position: absolute;
  left: 50%;
  top: 60%;
  transform: translate(-50%, -50%);
  width: 102px;
  height: 102px;
  border-radius: 50%;
  background: conic-gradient(var(--gold) var(--p, 0%), rgba(255,255,255,0.16) 0%);
  mask: radial-gradient(circle, transparent 66%, black 68%);
  z-index: 4;
}

.hint {
  margin: 0;
  text-align: center;
  font-size: 1.1rem;
  letter-spacing: 0.2px;
  text-shadow: 0 4px 16px rgba(0, 0, 0, 0.52);
}

.letter-stage {
  opacity: 0;
  pointer-events: none;
  transition: opacity 900ms ease;
}

.letter-stage.active {
  opacity: 1;
  pointer-events: auto;
}

.letter {
  width: min(94vw, 790px);
  max-height: 82vh;
  overflow-y: auto;
  border-radius: 18px;
  padding: clamp(1.4rem, 4vw, 3.4rem);
  color: var(--ink);
  background:
    linear-gradient(150deg, rgba(255,255,255,0.4), transparent 40%),
    linear-gradient(145deg, var(--paper), var(--paper-2));
  box-shadow: 0 30px 85px rgba(0, 0, 0, 0.55);
  transform-origin: top center;
  transform-style: preserve-3d;
  transition: transform 1.2s cubic-bezier(0.19, 1, 0.22, 1), filter 1.2s ease;
}

.letter.folded {
  transform: rotateX(-88deg) translateY(200px) scale(0.72);
  filter: blur(2px);
}

.letter h2 {
  margin: 0 0 1rem;
  font-family: 'Great Vibes', cursive;
  font-weight: 400;
  font-size: clamp(2.4rem, 6vw, 3.8rem);
}

.line,
.signature {
  margin: 0 0 1rem;
  min-height: 1.4em;
  opacity: 0;
  line-height: 1.62;
  font-size: clamp(1.2rem, 2.3vw, 1.63rem);
}

.signature {
  margin-top: 1.3rem;
  font-family: 'Great Vibes', cursive;
  font-size: clamp(2rem, 5vw, 3.1rem);
}

.line.visible,
.signature.visible {
  opacity: 1;
  animation: breatheIn 650ms ease forwards;
}

.controls { display: flex; gap: 0.6rem; }

.btn {
  border: 1px solid rgba(255, 227, 195, 0.5);
  background: rgba(14, 15, 25, 0.46);
  color: var(--ivory);
  border-radius: 999px;
  padding: 0.58rem 1.1rem;
  cursor: pointer;
  font-size: 1rem;
}

.overlay {
  position: fixed;
  inset: 0;
  z-index: 8;
  display: grid;
  place-items: center;
  background: radial-gradient(circle at center, rgba(12, 12, 19, 0.86), rgba(4, 4, 8, 0.98));
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease;
}

.overlay.active {
  opacity: 1;
  pointer-events: auto;
}

.intro-inner {
  width: min(92vw, 560px);
  text-align: center;
}

.eyebrow {
  margin: 0;
  color: rgba(255, 219, 179, 0.95);
  font-size: clamp(1.3rem, 3.5vw, 2rem);
  letter-spacing: 0.4px;
}

.intro h1 {
  margin: 0.2rem 0 0.6rem;
  font-family: 'Great Vibes', cursive;
  font-size: clamp(2.8rem, 8vw, 4.8rem);
  font-weight: 400;
}

.loader-label { margin: 0 0 0.7rem; font-size: 1.1rem; }
.loader-track { height: 8px; background: rgba(255,255,255,0.12); border-radius: 999px; overflow: hidden; }
.loader-bar { display: block; width: 0%; height: 100%; background: linear-gradient(90deg, #ffcb95, #fbb574); transition: width 2.2s cubic-bezier(0.2, 0.8, 0.2, 1); }

.outro p {
  margin: 0 0 1rem;
  text-align: center;
  font-family: 'Great Vibes', cursive;
  font-size: clamp(2.8rem, 8vw, 5rem);
}

@keyframes floatEnvelope {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

@keyframes drift {
  from { transform: rotate(18deg) translateX(-12px); }
  to { transform: rotate(18deg) translateX(16px); }
}

@keyframes breatheIn {
  from { transform: translateY(8px); filter: blur(3px); }
  to { transform: translateY(0); filter: blur(0); }
}

@media (max-width: 640px) {
  .light-ray { opacity: 0.4; }
  .letter { max-height: 74vh; border-radius: 14px; }
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
